# 小马过河 —— 试水 ~~~

// no-translate

聊过了历史，也有了决心和勇气，那就让我们先把一只前蹄探到水里试试。

我们的教学任务是做一个 TODO（待做事项）应用。

TODO 是一个经典应用，其目的就是用来为萌新展示如何用特定的前端框架或库实现一组特定的功能。当然，TODO 的需求太过简单，不足以展示 Angular 的长处，但是用来作为我们萌新教程的第一步，还是非常合适的。

为了降低大家的学习曲线，我将尽量避免引入那些为长线项目准备的最佳实践，一切以简明为最高标准。

## 准备环境

<div class="l-sub-section">

如果你已经安装好了 angular-cli，那么请直接[跳过本节](#创建工程)。

</div>

现在的前端早已从手工时代进化到了工程化时代，因此，要做好前端开发，我们需要一系列工具，我们将其统称为工具链（tool chain），意思是这些工具会像链条一样环环相扣，共同帮你完成开发工作。一听到 "系列工具"，你是不是已经感到头大了？别担心，Angular 为你准备好了一切。

Angular 是一个开箱即用的框架，对萌新来讲，学 Angular 只要会用一个工具就够了，那就是 Angular CLI。CLI 是 Command Line Interface 的缩写，意思是命令行界面。但不要一听到命令行就感到恐惧，事实上，在 Angular 的日常开发中，你会用到的命令只有那么几个，以后随着你的水平不断提高，才会不断接触新的高级命令。但目前，你只要会三板斧就可以定瓦岗了。接下来我就带大家先安装 Angular CLI。

前端工具链的基础就是我们前面提到过的 NodeJS，Angular CLI 也不例外。

如果你是 Windows，请先到NodeJS的官方网站 <https://nodejs.org/en/> 下载并安装 NodeJS 8.x，只要按照向导一直下一步就行了。如果是 Linux / Mac，建议按照 <https://github.com/creationix/nvm> 中的指引安装一个nvm来管理 NodeJS 版本，它可以让你不必提供 root 权限就可以正常使用 NodeJS。

安装好 NodeJS 之后，如果你是 Windows 系统，那么还需要一个额外的步骤才能让 Angular CLI正常工作，那就是安装 Python 2.7，注意，不能用 3.x 版本。其实它并不是 Angular 需要的，而是 Angular CLI 中的一个子模块需要的。安装完之后，重新开启一下 cmd 窗口就可以了。

接下来我们就可以开始安装 Angular CLI 了，只要一条命令即可：

`npm install --global @angular/cli`

这个过程会比较长，可以先放松一会儿再回来。运行完之后，它就在你的系统中创建了一条新的命令：`ng`，也就是 Angular 的缩写。

要验证你的安装成果，请在 cmd（windows）或 terminal（Linux / Mac）窗口（以后简称 "命令窗口"）中输入命令：

`ng -v`

你将会看到 @angular/cli 及其依赖库的详细信息。

就是这么简单。

## 创建工程

一旦环境准备好，我们就可以开工了。

创建工程只要一条命令就可以了：

`ng new todo-tiny`

其中的`todo-tiny`是工程名，我们要创建一个极小的todo应用，也就是说先不考虑以后的演化和多人协作等需求，稍后的章节中我们再把这些加进去。

它会在当前目录下创建一个名叫`todo-tiny`的子目录，并且自动安装它所依赖的npm包。

然后，我们在命令窗口中敲 `cd todo-tiny` 进入这个子目录。这个目录我们称之为此工程的根目录，简称根目录。

## 启动开发服务器

接下来，我们要在这里启动一个开发服务器。所谓开发服务器，就是指仅供开发期间使用的服务器。

我们在发布前端程序时，通常会编译成静态网站进行发布，也就是说，它不依赖服务器环境，无论是JRE还是NodeJS，在发布后都不需要。你可以把它像一个普通的静态网站一样发布在nginx、apache、IIS等静态网站服务器上，而不需要任何插件。甚至你可以把整个前端程序扔到CDN上去，以获得全国各地的网络优化。

但是在开发期间，我们必须在浏览器中预览前端程序的运行效果，而不能盲改。于是我们需要一个 HTTP 服务器来把它跑起来。幸运的是，要实现这一点，你并不需要自己在电脑上配置一个 HTTP 服务器，Angular CLI 全都给你集成好了。我们只要运行另一条命令就可以了：

`ng serve`

它会启动一个 http 服务器，并监听本地的 4200 端口，也就是说，你可以在浏览器中输入：`http://localhost:4200`来访问我们这台开发服务器，你在这个网站中看到的内容和最终发布之后用户看到的是一样的。

极少数用户可能会启动失败，看到结果里面的大段英文可能直接懵圈了，别慌，心平气和的阅读一下错误信息，其实这种问题一般是由于 4200 端口被别的程序占用导致的，可能是某个应用恰好占用了这个端口，也可能是你运行着另外一个 `ng serve`。这种情况下，我们可以添加一个参数来指定新的端口，比如：

`ng serve --port 4201`

当然，总是这样找端口也很烦，不过 ng 都替你想到了，你可以把端口指定为 0 ，这样它就会自动寻找 4200 之后第一个可用的端口来启动开发服务器：

`ng serve --port 0 --open`

这里的 `--open` 参数是懒人的福音，如果你加了这个参数，它就会自动帮你用浏览器打开这个开发服务器。比如在 4200 已经被占用而 4201 空闲的情况下，它会帮你自动打开 `http://localhost:4201` 。

## 把项目添加到 git 中

git 是工程化开发中最常用的版本管理工具之一，我们的这个教程将全程使用它。除非你们公司已经有钦定的版本管理工具，否则我建议你从 git 开始。

简单来说，所谓版本管理就是你的 "后悔药"，是开发中的超级 undo / redo 功能。

删错了代码？没关系，恢复到上一个版本就行了。

想知道自己刚刚改了什么？没关系，和上一个版本对比一下就可以了。

想知道别人对你的代码做过什么？没关系，看看他的提交历史就知道了。

git 就是这样一个工具，用好它已经是几乎所有程序员的标配技能。

如果你还没有安装过 git ，请到 <https://git-scm.com/> 按照说明进行安装。

目前，主流的 IDE 基本已经集成好了 git，你只要探索一下它就可以了。如果你使用的是小众编辑器，那么可以使用命令行来操作git，也可以安装一个 Source Tree 软件，它是一个图形化的 git 工具，而且比某些 IDE 中的 git 插件还要强大。

为了教学方便，本教程只给出操作的命令行形式（其实只涉及少数几条命令），大家可以自己对应图形界面的操作。

首先，我们在当前的项目目录下初始化 git 仓库：

`git init`

这样，以后我们才能在这里执行 git 命令。

接下来，我们要把当前项目中的所有文件添加到 git 中：

`git add .`

其中的 . 表示当前目录，也就是当前目录下的所有文件（递归）。

这条命令只是把这些文件添加到了一个缓冲区中，仍然不算是正式提交，也就是说，这些文件尚未被记录到历史中，因此将来也无法被恢复出来。要正式提交它，请用命令：

`git commit -m "提交说明"`

其中的提交说明是你对于当前这个提交的描述，这样，将来你在查看历史的时候就能知道这次提交的这些文件做了什么事。显然，我们应该让提交记录具有更好的可读性，这也是软件可维护性的一部分。要提高可读性，有两个重点：

1. 应该小步提交，频繁提交。

    如果在一次提交中包含了太多东西，那你就会不知道该怎么写提交说明 —— 总不能在提交说明里写一篇作文吧？所以，每次提交都应该有清晰的目的，每完成一个子任务就要提交一次。特别是对于批量替换、调整文件夹结构之类的操作，更应该单独提交，不要在做这些操作时还顺便改个bug啥的。

1. 提交说明应该遵循特定的格式。

    如果你在一个团队中，那么这个团队应该推出一个公共的提交说明格式规范。让大家的提交说明保持格式统一，除了读起来会赏心悦目之外，还有助于将来进行自动化处理。如果目前没有规范，可以参考 Angular 开发组的规范来制定一个：<https://github.com/angular/angular/blob/master/CONTRIBUTING.md#commit>。

现在，我们只是创建了工程，还什么也没有做，所以要先做一次初始提交，以便区分开哪些是自动生成的代码，哪些是我们自己写的。命令如下：

`git commit -m "Initial commit"`

Initial commit 的中文意思是初始提交，这么写算是一个惯例。

// 这里是你~~应该~~看不见的剧透：对于毕业生来讲，如果你自己做的开源项目有清晰整洁的 git 提交记录，面试官没准会高看你一眼哦！

## 开始编辑

在启动开发服务器的同时，`ng serve` 还会自动监听当前工程中的文件变化（比如增删改等）。一旦有变化，就会重新编译这些文件，并且刷新浏览器。

有了这个功能，你就可以进入一个轻松写意的开发循环了：编辑文件、看效果、编辑文件、看效果，以此类推。当然，后面我还会介绍一种更加强力的开发循环，但现在，这种简单循环就已经绰绰有余了。

你可以使用任何编辑器或 IDE 编辑这些文件。

如果你是一个资深 Java 程序员（包括 Android 程序员），那么可以选择 IntelliJ / WebStorm，它们都支持 Angular （IntelliJ 的老版本可能需要自己安装 AngularJS 插件），这种支持几乎已经达到了对主流 Java 框架的支持级别，各种代码提示、重构之类的都溜得飞起。

如果你习惯于使用 Eclipse 系列 IDE ，那么可以尝试一下 [Angular IDE](https://www.genuitec.com/products/angular-ide/)，这是由 MyEclipse 的出品公司推出的免费 IDE。

如果你是一个 .NET 程序员，那么可以选择 Visual Studio Code，它有很多插件可以为 Web 开发和 Angular 开发提供支持，并且是免费的。它本身的开发语言使用的是和 Angular 一样的 TypeScript，如果你学会了 TypeScript ，就可以随心所欲的给它写插件了。

当然，你也可以使用任何你喜欢的编辑器或 IDE。Angular CLI 并不要求任何特定的编辑器。

现在，你可以先在这里随意玩耍，下一节我们就会正式开始写代码了。

玩够了之后，运行下列命令把刚才的修改全都撤销，恢复到干干净净的初始状态：

`git reset --hard`

当然，在正式开发中要慎用这条命令，因为它会撤销你尚未提交（commit）的所有修改。
